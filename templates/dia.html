{% extends "base.html" %}
{% block content %}

{% include "partials/filter_bar.html" %}
{% include "partials/last_days.html" %}

<div class="card">
    <div class="card-title">Informe del D√≠a</div>

    {% if error %}
        <p style="color:#ff6b6b;">‚ö†Ô∏è {{ error }}</p>
    {% else %}
        <p>
            Reporte completo del d√≠a: 
            <span style="color:#00eaff; font-weight:600;">{{ data.fecha|fecha_dia(None, False) }}</span>
        </p>

        <a class="btn" href="/descargar-json?fecha={{ data.fecha }}">üì• Descargar JSON</a>
    {% endif %}
</div>


{% if data %}

<!-- =============================== -->
<!-- RESUMEN GENERAL -->
<!-- =============================== -->
<div class="card">
    <div class="card-title">Resumen</div>

    <p>Total online: <span class="badge {{ list_font_class }} badge-green">{{ data.resumen.total_online|duracion_hm }}</span></p>
    <p>Sesiones: <span class="badge {{ list_font_class }} badge-yellow">{{ data.resumen.sesiones }}</span></p>
</div>



<!-- =============================== -->
<!-- SESIONES DEL D√çA -->
<!-- =============================== -->
<div class="card">
    <div class="card-title">Sesiones</div>

    {% if data.sesiones %}
    <div class="table-container">
        <table class="{{ list_font_class }}">
            <tr>
                <th>Inicio</th>
                <th>Fin</th>
                <th>Duraci√≥n</th>
            </tr>

            {% for s in data.sesiones %}
            <tr class="{{ 'falso' if s.falso else '' }}">
                <td>{{ s.inicio|fecha_dia }}</td>
                <td>{{ s.fin|fecha_dia }}</td>
                <td class="right-align {{ list_font_class }}"><span class="{{ charla_badge_class(s.duracion, s.inicio) }} {{ list_font_class }}">{{ s.duracion|duracion_hm }}</span></td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
        <p>No hay sesiones este d√≠a.</p>
    {% endif %}
</div>



<!-- =============================== -->
<!-- GAPS -->
<!-- =============================== -->
<div class="card">
    <div class="card-title">Gaps</div>

    <h3 style="margin-top:15px;">Sue√±o</h3>
    {% if data.gaps.sueno %}
    <div class="table-container">
        <table class="{{ list_font_class }}">
            <tr><th>Inicio</th><th>Fin</th><th>Duraci√≥n</th></tr>
            {% for g in data.gaps.sueno %}
            <tr class="{{ 'falso' if g.falso else '' }}">
                <td>{{ g.inicio|fecha_dia }}</td>
                <td>{{ g.fin|fecha_dia }}</td>
                <td class="right-align {{ list_font_class }}">{{ g.duracion|duracion_hm }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
    <p>No hubo sue√±o detectado.</p>
    {% endif %}


    <h3 style="margin-top:15px;">Sospechosos</h3>
    {% if data.gaps.sospechosos %}
    <div class="table-container">
        <table class="{{ list_font_class }}">
            <tr><th>Inicio</th><th>Fin</th><th>Duraci√≥n</th></tr>
            {% for g in data.gaps.sospechosos %}
            <tr class="{{ 'falso' if g.falso else '' }}">
                <td>{{ g.inicio|fecha_dia }}</td>
                <td>{{ g.fin|fecha_dia }}</td>
                <td class="right-align badge {{ list_font_class }} badge-yellow">{{ g.duracion|duracion_hm }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
    <p>No hubo gaps sospechosos.</p>
    {% endif %}


    <h3 style="margin-top:15px;">Rojos</h3>
    {% if data.gaps.rojos %}
    <div class="table-container">
        <table class="{{ list_font_class }}">
            <tr><th>Inicio</th><th>Fin</th><th>Duraci√≥n</th></tr>
            {% for g in data.gaps.rojos %}
            <tr class="{{ 'falso' if g.falso else '' }}">
                <td>{{ g.inicio|fecha_dia }}</td>
                <td>{{ g.fin|fecha_dia }}</td>
                <td class="right-align badge {{ list_font_class }} badge-red">{{ g.duracion|duracion_hm }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
    <p>No hubo gaps rojos.</p>
    {% endif %}


    <h3 style="margin-top:15px;">Cita ‚ù§Ô∏è</h3>
    {% if data.gaps.cita %}
    <div class="table-container">
        <table class="{{ list_font_class }}">
            <tr><th>Inicio</th><th>Fin</th><th>Duraci√≥n</th></tr>
            {% for g in data.gaps.cita %}
            <tr class="{{ 'falso' if g.falso else '' }}">
                <td>{{ g.inicio|fecha_dia }}</td>
                <td>{{ g.fin|fecha_dia }}</td>
                <td class="right-align badge {{ list_font_class }} badge-red">{{ g.duracion|duracion_hm }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% else %}
    <p>No hubo gaps tipo cita.</p>
    {% endif %}
</div>



<!-- =============================== -->
<!-- CHARLAS -->
<!-- =============================== -->
<div class="card">
    <div class="card-title">Charlas</div>

    <h3>Largas (20+ min)</h3>
    {% if data.charlas.largas %}
        <ul>
            {% for c in data.charlas.largas %}
            <li class="{{ list_font_class }}{% if c.falso %} falso{% endif %}">{{ c.inicio|fecha_dia }} ‚Üí {{ c.fin|fecha_dia }} (<span class="{{ charla_badge_class(c.duracion, c.inicio) }} {{ list_font_class }}">{{ c.duracion|duracion_hm }}</span>)</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No hubo charlas largas.</p>
    {% endif %}

    <h3>Muy largas (45+ min)</h3>
    {% if data.charlas.muy_largas %}
        <ul>
            {% for c in data.charlas.muy_largas %}
            <li class="{{ list_font_class }}{% if c.falso %} falso{% endif %}">{{ c.inicio|fecha_dia }} ‚Üí {{ c.fin|fecha_dia }} (<span class="{{ charla_badge_class(c.duracion, c.inicio) }} {{ list_font_class }}">{{ c.duracion|duracion_hm }}</span>)</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No hubo charlas muy largas.</p>
    {% endif %}

    <h3>√çntimas (60+ min)</h3>
    {% if data.charlas.intimas %}
        <ul>
            {% for c in data.charlas.intimas %}
            <li class="{{ list_font_class }}{% if c.falso %} falso{% endif %}">{{ c.inicio|fecha_dia }} ‚Üí {{ c.fin|fecha_dia }} (<span class="{{ charla_badge_class(c.duracion, c.inicio) }} {{ list_font_class }}">{{ c.duracion|duracion_hm }}</span>)</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No hubo charlas √≠ntimas.</p>
    {% endif %}
</div>

{% endif %}

{% endblock %}

